imputed_vals <- x[imputed_pos]
ks.test(real_vals, imputed_vals)$statistic
}, numeric(1))
best_idx <- which.min(unname(ks_distances))
trend_errors <- vapply(imputed_Kvalues, function(x) {
df_temp <- data.frame(k = x, day = data_for_imputation$day)
mod <- lm(k ~ day, data = df_temp[-imputed_pos, ])
preds <- predict(mod, newdata = df_temp[imputed_pos, ])
mean((x[imputed_pos] - preds)^2)
}, numeric(1))
best_idx <- which.min(trend_errors)
complete_data <- complete(imp, "long")
dt <- as.data.frame(cor(complete_data[, -c(14, 15)], use = "complete.obs"))
kableExtra::kable(dt, "html", caption = "Table 3: Correlation matrix (imputed data)") |>
kableExtra::kable_styling(full_width = FALSE, font_size = 10) |>
kableExtra::scroll_box(width = "100%", height = "400px")
imputed_df <- lapply(seq_len(m), function(i) {
df <- complete(imp, i)
df$`K value` <- calculate_kvalue(df)
df
})
graphics <- lapply(seq_along(imputed_df), function(i) {
graphical_comparation(imputed_df[[i]], imputed_pos = imputed_pos, x = "day", y = "K value", x_ignore = TRUE, dataset_id = i)
})
knitr::include_graphics("plot/imputation_2_Kvalue.png")
knitr::include_graphics("plot/imputation_5_Kvalue.png")
data_imputated <- imputed_df[[5]]
dt <- as.data.frame(data_imputated)
kableExtra::kable(dt, "html", caption = "Table 4: Imputed dataset") |>
kableExtra::kable_styling(full_width = FALSE, font_size = 10) |>
kableExtra::scroll_box(width = "100%", height = "400px") |>
kableExtra::row_spec(imputed_pos, background = "#9B1B30", color = "white")
data_imputated$class <- ifelse(data_imputated$`K value` < 0.2, "very fresh",
ifelse(data_imputated$`K value` <= 0.5, "good/acceptable", "impending spoilage/spoiled"))
data_imputated$class <- as.factor(data_imputated$class)
ggplot(data_imputated, aes(x = `K value`, fill = class)) +
geom_histogram(position = "identity", alpha = 0.8, bins = 30, color = "white") +
scale_fill_manual(values = c("good/acceptable" = "#003366", "impending spoilage/spoiled" = "#9B1B30"), name = "Class") +
labs(
title = "Distribution of K Values by Class",
x = "K Value",
y = "Count"
) +
theme_minimal(base_size = 12) +
theme(
plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
axis.title = element_text(size = 12), axis.text = element_text(size = 10),
panel.grid.major = element_line(color = "lightgray", linewidth = 0.5),
panel.grid.minor = element_blank(), legend.position = "top", legend.title = element_text(face = "bold")
)
data_cluster <- data_analysis |> dplyr::select(grep("^[[:digit:]]*$", colnames(data_analysis), value = TRUE))
colnames(data_cluster) <- paste0("V", colnames(data_cluster))
data_cluster_smooth <- smoothing(data_cluster)
data_cluster_snv <- as_tibble(t(apply(data_cluster_smooth, MARGIN = 1, FUN = normalization)))
plot_spectral_comparison(data_cluster, data_cluster_snv)
knitr::include_graphics("plot/spectral_smoothing_comparison.png")
data_cluster_final <- bind_cols(data_cluster_snv, class = as.factor(data_imputated$class))
source("settings.R")
source("source_all.R")
if (!file.exists("data/intermediate/data analysis.rds")) {
build_data_main()
}
data_analysis <- readRDS("data/intermediate/data analysis.rds")
kableExtra::kable(data_analysis[,1:20], "html", caption = "Table 1: Original dataset") |>
kableExtra::kable_styling(full_width = FALSE, font_size = 10) |>
kableExtra::scroll_box(width = "100%", height = "400px")
knitr::include_graphics("plot/densities1.png")
knitr::include_graphics("plot/densities2.png")
pattern <- "^[[:digit:]]*$"
data_for_imputation <- data_analysis |> dplyr::select(!c(grep(pattern, colnames(data_analysis)), sample))
dt <- as.data.frame(cor(data_for_imputation, use = "complete.obs"))
kableExtra::kable(dt, "html", caption = "Table 2: Correlation matrix (only complete cases)") |>
kableExtra::kable_styling(full_width = FALSE, font_size = 10) |>
kableExtra::scroll_box(width = "100%", height = "400px")
m <- 10
imp <- mice(data_for_imputation[, -7], m = m, maxit = 50, seed = 123, method = "pmm", printFlag = FALSE)
imputed_Kvalues <- lapply(seq_len(m), function(i) {
df <- complete(imp, i)
df$`K value` <- calculate_kvalue(df)
})
imputed_pos <- which(is.na(data_for_imputation$`K value`))
real_vals <- data_for_imputation$`K value`[-imputed_pos]
ks_distances <- vapply(imputed_Kvalues, function(x) {
imputed_vals <- x[imputed_pos]
ks.test(real_vals, imputed_vals)$statistic
}, numeric(1))
best_idx <- which.min(unname(ks_distances))
trend_errors <- vapply(imputed_Kvalues, function(x) {
df_temp <- data.frame(k = x, day = data_for_imputation$day)
mod <- lm(k ~ day, data = df_temp[-imputed_pos, ])
preds <- predict(mod, newdata = df_temp[imputed_pos, ])
mean((x[imputed_pos] - preds)^2)
}, numeric(1))
best_idx <- which.min(trend_errors)
complete_data <- complete(imp, "long")
dt <- as.data.frame(cor(complete_data[, -c(14, 15)], use = "complete.obs"))
kableExtra::kable(dt, "html", caption = "Table 3: Correlation matrix (imputed data)") |>
kableExtra::kable_styling(full_width = FALSE, font_size = 10) |>
kableExtra::scroll_box(width = "100%", height = "400px")
imputed_df <- lapply(seq_len(m), function(i) {
df <- complete(imp, i)
df$`K value` <- calculate_kvalue(df)
df
})
graphics <- lapply(seq_along(imputed_df), function(i) {
graphical_comparation(imputed_df[[i]], imputed_pos = imputed_pos, x = "day", y = "K value", x_ignore = TRUE, dataset_id = i)
})
knitr::include_graphics("plot/imputation_2_Kvalue.png")
knitr::include_graphics("plot/imputation_5_Kvalue.png")
data_imputated <- imputed_df[[5]]
dt <- as.data.frame(data_imputated)
kableExtra::kable(dt, "html", caption = "Table 4: Imputed dataset") |>
kableExtra::kable_styling(full_width = FALSE, font_size = 10) |>
kableExtra::scroll_box(width = "100%", height = "400px") |>
kableExtra::row_spec(imputed_pos, background = "#9B1B30", color = "white")
data_imputated$class <- ifelse(data_imputated$`K value` < 0.2, "very fresh",
ifelse(data_imputated$`K value` <= 0.5, "good/acceptable", "impending spoilage/spoiled"))
data_imputated$class <- as.factor(data_imputated$class)
ggplot(data_imputated, aes(x = `K value`, fill = class)) +
geom_histogram(position = "identity", alpha = 0.8, bins = 30, color = "white") +
scale_fill_manual(values = c("good/acceptable" = "#003366", "impending spoilage/spoiled" = "#9B1B30"), name = "Class") +
labs(
title = "Distribution of K Values by Class",
x = "K Value",
y = "Count"
) +
theme_minimal(base_size = 12) +
theme(
plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
plot.subtitle = element_text(hjust = 0.5, size = 12, face = "bold"),
axis.title = element_text(size = 12), axis.text = element_text(size = 10),
panel.grid.major = element_line(color = "lightgray", linewidth = 0.5),
panel.grid.minor = element_blank(), legend.position = "top", legend.title = element_text(face = "bold")
)
data_cluster <- data_analysis |> dplyr::select(grep("^[[:digit:]]*$", colnames(data_analysis), value = TRUE))
colnames(data_cluster) <- paste0("V", colnames(data_cluster))
data_cluster_smooth <- smoothing(data_cluster)
data_cluster_snv <- as_tibble(t(apply(data_cluster_smooth, MARGIN = 1, FUN = normalization)))
plot_spectral_comparison(data_cluster, data_cluster_snv)
knitr::include_graphics("plot/spectral_smoothing_comparison.png")
data_cluster_final <- bind_cols(data_cluster_snv, class = as.factor(data_imputated$class))
task <- TaskClassif$new(
id = "Classification original data",
backend = data_cluster_final,
target = "class",
positive = "good/acceptable"
)
task$col_roles$stratum <- "class"
methods <- c("anova", "auc", "mrmr")
tab <- as.data.frame(lapply(methods, function(i) feature_selection(task, i)))
colnames(tab) <- methods
kableExtra::kable(tab, "html", caption = "Table 6: Feature selection") |>
kableExtra::kable_styling(full_width = FALSE, font_size = 10) |>
kableExtra::scroll_box(width = "100%", height = "400px")
set.seed(123)
resampling_outer <- rsmp("cv", folds = 5)
resampling_instance <- resampling_outer$instantiate(task)
if (!file.exists("data/results/results1.rds")) {
feature_analysis(task, resampling_instance = resampling_instance)
}
results1 <- readRDS("data/results/results1.rds")
kableExtra::kable(results1$performance, caption = "Table 7: Model performances") |>
kableExtra::kable_styling(full_width = FALSE, font_size = 10) |>
kableExtra::scroll_box(width = "100%", height = "400px")
plot_benchmark_results(results1$benchmark_obj)
kableExtra::kable(results1$confusion$QDA, caption = "Table 8: Confusion matrix QDA model") |>
kableExtra::kable_styling(full_width = FALSE, font_size = 10) |>
kableExtra::scroll_box(width = "100%", height = "400px")
task_v1459 = task$clone()$select("V1459")
autoplot(task_v1459, type = "duo") +
theme_minimal() +
scale_fill_viridis_d(end = 0.8) +
labs(
title = "Discriminazione della Freshness tramite V1459 (Soglia 0.5)",
x = "Intensità Spettrale (SNV-Normalized)",
y = "Densità"
)
library(mlr3viz)
library(ggplot2)
set.seed(123)
resampling_outer <- rsmp("cv", folds = 5)
resampling_instance <- resampling_outer$instantiate(task)
if (!file.exists("data/results/results1.rds")) {
feature_analysis(task, resampling_instance = resampling_instance)
}
results1 <- readRDS("data/results/results1.rds")
kableExtra::kable(results1$performance, caption = "Table 7: Model performances") |>
kableExtra::kable_styling(full_width = FALSE, font_size = 10) |>
kableExtra::scroll_box(width = "100%", height = "400px")
plot_benchmark_results(results1$benchmark_obj)
kableExtra::kable(results1$confusion$QDA, caption = "Table 8: Confusion matrix QDA model") |>
kableExtra::kable_styling(full_width = FALSE, font_size = 10) |>
kableExtra::scroll_box(width = "100%", height = "400px")
task_v1459 = task$clone()$select("V1459")
autoplot(task_v1459, type = "duo") +
theme_minimal() +
scale_fill_viridis_d(end = 0.8) +
labs(
title = "Discriminazione della Freshness tramite V1459 (Soglia 0.5)",
x = "Intensità Spettrale (SNV-Normalized)",
y = "Densità"
)
install.packages("GGally")
library(GGally)
set.seed(123)
resampling_outer <- rsmp("cv", folds = 5)
resampling_instance <- resampling_outer$instantiate(task)
if (!file.exists("data/results/results1.rds")) {
feature_analysis(task, resampling_instance = resampling_instance)
}
results1 <- readRDS("data/results/results1.rds")
kableExtra::kable(results1$performance, caption = "Table 7: Model performances") |>
kableExtra::kable_styling(full_width = FALSE, font_size = 10) |>
kableExtra::scroll_box(width = "100%", height = "400px")
plot_benchmark_results(results1$benchmark_obj)
kableExtra::kable(results1$confusion$QDA, caption = "Table 8: Confusion matrix QDA model") |>
kableExtra::kable_styling(full_width = FALSE, font_size = 10) |>
kableExtra::scroll_box(width = "100%", height = "400px")
task_v1459 = task$clone()$select("V1459")
autoplot(task_v1459, type = "duo") +
theme_minimal() +
scale_fill_viridis_d(end = 0.8) +
labs(
title = "Discriminazione della Freshness tramite V1459 (Soglia 0.5)",
x = "Intensità Spettrale (SNV-Normalized)",
y = "Densità"
)
source("settings.R")
source("source_all.R")
if (!file.exists("data/intermediate/data analysis.rds")) {
build_data_main()
}
data_analysis <- readRDS("data/intermediate/data analysis.rds")
kableExtra::kable(data_analysis[,1:20], "html", caption = "Table 1: Original dataset") |>
kableExtra::kable_styling(full_width = FALSE, font_size = 10) |>
kableExtra::scroll_box(width = "100%", height = "400px")
knitr::include_graphics("plot/densities1.png")
knitr::include_graphics("plot/densities2.png")
pattern <- "^[[:digit:]]*$"
data_for_imputation <- data_analysis |> dplyr::select(!c(grep(pattern, colnames(data_analysis)), sample))
dt <- as.data.frame(cor(data_for_imputation, use = "complete.obs"))
kableExtra::kable(dt, "html", caption = "Table 2: Correlation matrix (only complete cases)") |>
kableExtra::kable_styling(full_width = FALSE, font_size = 10) |>
kableExtra::scroll_box(width = "100%", height = "400px")
m <- 10
imp <- mice(data_for_imputation[, -7], m = m, maxit = 50, seed = 123, method = "pmm", printFlag = FALSE)
imputed_Kvalues <- lapply(seq_len(m), function(i) {
df <- complete(imp, i)
df$`K value` <- calculate_kvalue(df)
})
imputed_pos <- which(is.na(data_for_imputation$`K value`))
real_vals <- data_for_imputation$`K value`[-imputed_pos]
ks_distances <- vapply(imputed_Kvalues, function(x) {
imputed_vals <- x[imputed_pos]
ks.test(real_vals, imputed_vals)$statistic
}, numeric(1))
best_idx <- which.min(unname(ks_distances))
trend_errors <- vapply(imputed_Kvalues, function(x) {
df_temp <- data.frame(k = x, day = data_for_imputation$day)
mod <- lm(k ~ day, data = df_temp[-imputed_pos, ])
preds <- predict(mod, newdata = df_temp[imputed_pos, ])
mean((x[imputed_pos] - preds)^2)
}, numeric(1))
best_idx <- which.min(trend_errors)
complete_data <- complete(imp, "long")
dt <- as.data.frame(cor(complete_data[, -c(14, 15)], use = "complete.obs"))
kableExtra::kable(dt, "html", caption = "Table 3: Correlation matrix (imputed data)") |>
kableExtra::kable_styling(full_width = FALSE, font_size = 10) |>
kableExtra::scroll_box(width = "100%", height = "400px")
imputed_df <- lapply(seq_len(m), function(i) {
df <- complete(imp, i)
df$`K value` <- calculate_kvalue(df)
df
})
if (!file.exists("plot/imputation_1_Kvalue.png")) {
graphics <- lapply(seq_along(imputed_df), function(i) {
graphical_comparation(imputed_df[[i]], imputed_pos = imputed_pos, x = "day", y = "K value", x_ignore = TRUE, dataset_id = i)
})
}
knitr::include_graphics("plot/imputation_2_Kvalue.png")
knitr::include_graphics("plot/imputation_5_Kvalue.png")
data_imputated <- imputed_df[[5]]
dt <- as.data.frame(data_imputated)
kableExtra::kable(dt, "html", caption = "Table 4: Imputed dataset") |>
kableExtra::kable_styling(full_width = FALSE, font_size = 10) |>
kableExtra::scroll_box(width = "100%", height = "400px") |>
kableExtra::row_spec(imputed_pos, background = "#9B1B30", color = "white")
data_imputated$class <- ifelse(data_imputated$`K value` < 0.2, "very fresh",
ifelse(data_imputated$`K value` <= 0.5, "good/acceptable", "impending spoilage/spoiled"))
data_imputated$class <- as.factor(data_imputated$class)
ggplot(data_imputated, aes(x = `K value`, fill = class)) +
geom_histogram(position = "identity", alpha = 0.8, bins = 30, color = "white") +
scale_fill_manual(values = c("good/acceptable" = "#003366", "impending spoilage/spoiled" = "#9B1B30"), name = "Class") +
labs(
title = "Distribution of K Values by Class",
x = "K Value",
y = "Count"
) +
theme_minimal(base_size = 12) +
theme(
plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
plot.subtitle = element_text(hjust = 0.5, size = 12, face = "bold"),
axis.title = element_text(size = 12), axis.text = element_text(size = 10),
panel.grid.major = element_line(color = "lightgray", linewidth = 0.5),
panel.grid.minor = element_blank(), legend.position = "top", legend.title = element_text(face = "bold")
)
data_cluster <- data_analysis |> dplyr::select(grep("^[[:digit:]]*$", colnames(data_analysis), value = TRUE))
colnames(data_cluster) <- paste0("V", colnames(data_cluster))
data_cluster_smooth <- smoothing(data_cluster)
data_cluster_snv <- as_tibble(t(apply(data_cluster_smooth, MARGIN = 1, FUN = normalization)))
plot_spectral_comparison(data_cluster, data_cluster_snv)
knitr::include_graphics("plot/spectral_smoothing_comparison.png")
data_cluster_final <- bind_cols(data_cluster_snv, class = as.factor(data_imputated$class))
data_cluster <- data_analysis |> dplyr::select(grep("^[[:digit:]]*$", colnames(data_analysis), value = TRUE))
colnames(data_cluster) <- paste0("V", colnames(data_cluster))
data_cluster_smooth <- smoothing(data_cluster)
data_cluster_snv <- as_tibble(t(apply(data_cluster_smooth, MARGIN = 1, FUN = normalization)))
plot_spectral_comparison(data_cluster, data_cluster_snv)
knitr::include_graphics("plot/spectral_smoothing_comparison.png")
data_cluster_final <- bind_cols(data_cluster_snv, class = as.factor(data_imputated$class))
task <- TaskClassif$new(
id = "Classification original data",
backend = data_cluster_final,
target = "class",
positive = "good/acceptable"
)
task$col_roles$stratum <- "class"
methods <- c("anova", "auc", "mrmr")
tab <- as.data.frame(lapply(methods, function(i) feature_selection(task, i)))
colnames(tab) <- methods
kableExtra::kable(tab, "html", caption = "Table 6: Feature selection") |>
kableExtra::kable_styling(full_width = FALSE, font_size = 10) |>
kableExtra::scroll_box(width = "100%", height = "400px")
set.seed(123)
resampling_outer <- rsmp("cv", folds = 5)
resampling_instance <- resampling_outer$instantiate(task)
if (!file.exists("data/results/results1.rds")) {
feature_analysis(task, resampling_instance = resampling_instance)
}
results1 <- readRDS("data/results/results1.rds")
kableExtra::kable(results1$performance, caption = "Table 7: Model performances") |>
kableExtra::kable_styling(full_width = FALSE, font_size = 10) |>
kableExtra::scroll_box(width = "100%", height = "400px")
if (!file.exists("plot/accuracy_stability1.png")) {
plot_benchmark_results(results1$benchmark_obj)
}
knitr::include_graphics("plot/accuracy_stability1.png")
knitr::include_graphics("plot/auc_stability1.png")
knitr::include_graphics("plot/roc_curves1.png")
kableExtra::kable(results1$confusion$QDA, caption = "Table 8: Confusion matrix QDA model") |>
kableExtra::kable_styling(full_width = FALSE, font_size = 10) |>
kableExtra::scroll_box(width = "100%", height = "400px")
preds <- as.data.table(results1$resampling$QDA$prediction())
false_positive_idx <- preds[truth == "impending spoilage/spoiled" & response == "good/acceptable", row_ids]
data_wrong <- data_imputated[false_positive_idx, ]
errors <- data.frame(
row_ID = false_positive_idx,
day = data_wrong$day,
`K value` = data_wrong$`K value`
)
kableExtra::kable(errors, caption = "Table 9: Spoiled samples classified as Fresh (false positives)") |>
kableExtra::kable_styling(full_width = FALSE, font_size = 10) |>
kableExtra::scroll_box(width = "100%", height = "400px")
data_imputated$class <- ifelse(data_imputated$`K value` < 0.2, "very fresh",
ifelse(data_imputated$`K value` <= 0.4, "good/acceptable", "impending spoilage/spoiled"))
data_cluster_final <- data_cluster_final |> dplyr::select(!class)
data_cluster_final <- bind_cols(data_cluster_final, class = as.factor(data_imputated$class))
ggplot(data_imputated, aes(x = `K value`, fill = class)) +
geom_histogram(position = "identity", alpha = 0.8, bins = 30, color = "white") +
scale_fill_manual(values = c("good/acceptable" = "#003366", "impending spoilage/spoiled" = "#9B1B30"), name = "Class") +
labs(
title = "Distribution of K Values by Class",
x = "K Value",
y = "Count"
) +
theme_minimal(base_size = 12) +
theme(
plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
plot.subtitle = element_text(hjust = 0.5, size = 12, face = "bold"),
axis.title = element_text(size = 12), axis.text = element_text(size = 10),
panel.grid.major = element_line(color = "lightgray", linewidth = 0.5),
panel.grid.minor = element_blank(), legend.position = "top", legend.title = element_text(face = "bold")
)
task <- TaskClassif$new(
id = "Classification original data",
backend = data_cluster_final,
target = "class",
positive = "good/acceptable"
)
task$col_roles$stratum <- "class"
set.seed(123)
resampling_outer <- rsmp("cv", folds = 5)
resampling_instance <- resampling_outer$instantiate(task)
if (!file.exists("data/results/results1.1.rds")) {
feature_analysis(task, resampling_instance = resampling_instance, new_results = TRUE)
}
results1.1 <- readRDS("data/results/results1.1.rds")
kableExtra::kable(results1.1$performance, caption = "Table 11: Model performances (threshold 0.4)") |>
kableExtra::kable_styling(full_width = FALSE, font_size = 10) |>
kableExtra::scroll_box(width = "100%", height = "400px")
if (!file.exists("plot/accuracy_stability2.png")) {
plot_benchmark_results(results1.1$benchmark_obj)
}
knitr::include_graphics("plot/accuracy_stability2.png")
knitr::include_graphics("plot/auc_stability2.png")
knitr::include_graphics("plot/roc_curves2.png")
preds <- as.data.table(results1.1$resampling$QDA$prediction())
false_positive_idx <- preds[truth == "impending spoilage/spoiled" & response == "good/acceptable", row_ids]
data_wrong <- data_imputated[false_positive_idx, ]
errors <- data.frame(
row_ID = false_positive_idx,
day = data_wrong$day,
`K value` = data_wrong$`K value`
)
kableExtra::kable(errors, caption = "Table 12: Spoiled samples classified as Fresh (false positives)") |>
kableExtra::kable_styling(full_width = FALSE, font_size = 10) |>
kableExtra::scroll_box(width = "100%", height = "400px")
pca_res <- prcomp(data_cluster_final[, -141], center = TRUE, scale. = TRUE)
var_exp <- head(summary(pca_res)$importance[3, ], 12)
dt_var_exp <- as.data.frame(t(var_exp))
kableExtra::kable(dt_var_exp, "html", caption = "Table 13: Cumulative variance explained by PCA components") |>
kableExtra::kable_styling(full_width = FALSE, font_size = 10)
pca_representation_facet(pca_res, as.factor(data_cluster_final$class), 6)
if (!file.exists("data/results/results2.rds")) {
feature_analysis(task, resampling_instance = resampling_instance, filter = FALSE, pca = TRUE)
}
results2 <- readRDS("data/results/results2.rds")
kableExtra::kable(results2$performance, caption = "Table 14: Model performances (PCA)") |>
kableExtra::kable_styling(full_width = FALSE, font_size = 10) |>
kableExtra::scroll_box(width = "100%", height = "400px")
if (!file.exists("plot/accuracy_stability3.png")) {
plot_benchmark_results(results2$benchmark_obj)
}
knitr::include_graphics("plot/accuracy_stability3.png")
knitr::include_graphics("plot/auc_stability3.png")
knitr::include_graphics("plot/roc_curves3.png")
loadings_df <- as.data.frame(pca_res$rotation[, 1:12])
loadings_df$wavelength <- as.numeric(gsub("V", "", rownames(loadings_df)))
loadings_long <- loadings_df |>
pivot_longer(
cols = starts_with("PC"),
names_to = "PC",
values_to = "Weight"
) |> mutate(PC = factor(PC, levels = paste0("PC", 1:12)))
ggplot(loadings_long, aes(x = wavelength, y = Weight, color = PC)) +
geom_line(show.legend = FALSE) +
facet_wrap(~PC, scales = "free_y", ncol = 3) +
labs(
title = "First 12 PCA loadings",
x = "Wavelength (nm)",
y = "Loading Weight"
) +
theme_minimal(base_size = 12) +
theme(
plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
axis.title = element_text(size = 12), axis.text = element_text(size = 10),
panel.grid.major = element_line(color = "lightgray", linewidth = 0.5),
panel.grid.minor = element_blank(), legend.position = "top", legend.title = element_text(face = "bold")
)
pc_pool <- paste0("PC", 1:8)
min_pc <- 2
max_pc <- 6
combinations_list <- map(min_pc:max_pc, function(k) {
combs <- combn(pc_pool, k, simplify = FALSE)
combs
}) |> flatten()
if (!file.exists("data/results/results_list.rds")) {
results_list <- lapply(combinations_list, function(x) {
model_qda_deep_dive(task, resampling_instance =  resampling.instance, pca_fix = TRUE, pca_selected = x)
})
saveRDS(results_list, file = "data/results/results_list.rds")
}
results_list <- readRDS("data/results/results_list.rds")
summary_df <- imap_dfr(results_list, extract_metrics)
top_10_results <- summary_df |> arrange(desc(auc), desc(spec)) |> head(10)
rownames(top_10_results) <- top_10_results$rank
top_10_results <- top_10_results |> dplyr::select(!rank)
kableExtra::kable(top_10_results, caption = "Table 15: Best model performances for different PCA combinations") |>
kableExtra::kable_styling(full_width = FALSE, font_size = 10) |>
kableExtra::scroll_box(width = "100%", height = "400px")
if (!file.exists("data/results/results_final.rds")) {
result_final<- model_qda_deep_dive(task, resampling_instance = resampling.instance, pca_rank = 12, pca_fix = TRUE, pca_selected = c("PC1", "PC2", "PC3", "PC4", "PC6", "PC7"))
saveRDS(result_final, file = "data/results/results_final.rds")
}
result_final <- readRDS("data/results/results_final.rds")
kableExtra::kable(t(result_final$performance), "html", caption = "Table 16: Optimized QDA model") |>
kableExtra::kable_styling(full_width = FALSE, font_size = 10)
kableExtra::kable(result_final$confusion_matrix, caption = "Table 17: Optimized QDA confusion matrix") |>
kableExtra::kable_styling(full_width = FALSE, font_size = 10) |>
kableExtra::scroll_box(width = "100%", height = "400px")
bmr <- as_benchmark_result(result_final$resampling_results)
if (!file.exists("plot/accuracy_stability4.png")) {
plot_benchmark_results(results1$benchmark_obj)
}
knitr::include_graphics("plot/accuracy_stability4.png")
knitr::include_graphics("plot/auc_stability4.png")
knitr::include_graphics("plot/roc_curves4.png")
preds <- as.data.table(result_final$resampling_result$prediction())
false_positive_idx <- preds[truth == "impending spoilage/spoiled" & response == "good/acceptable", row_ids]
data_wrong <- data_imputated[false_positive_idx, ]
errors <- data.frame(
row_ID = false_positive_idx,
day = data_wrong$day,
`K value` = data_wrong$`K value`
)
kableExtra::kable(errors, caption = "Table 18: Spoiled samples classified as Fresh (false positives)") |>
kableExtra::kable_styling(full_width = FALSE, font_size = 10) |>
kableExtra::scroll_box(width = "100%", height = "400px")
View(data_cluster_final)
summary(data_cluster)
summary(data_cluster_smooth)
summary(data_cluster_snv)
